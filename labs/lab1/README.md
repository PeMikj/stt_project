# Лабораторная работа №1 — Dockerfile

В этой лабораторной работе представлены два Dockerfile: плохой и хороший.  
Цель: продемонстрировать распространённые плохие практики и способы их исправления.



## ПЛОХИЕ ПРАКТИКИ В Dockerfile.bad

### 1. Тяжёлый базовый образ
Использован `python:3.12`, который значительно больше по размеру, чем `python:3.12-bookworm`.  
Это приводит к медленной сборке, большому объёму загружаемых данных и повышенному расходу места.

### 2. Установка apt-пакетов без очистки кэша
Строка: RUN apt-get update && apt-get install -y ffmpeg
оставляет кэш apt внутри слоя.  

### 3. COPY . . — копирование всей директории
В контейнер попадают лишние файлы. Это делает образ тяжёлым и небезопасным.

### 4. Зависимости без фиксированных версий
pip install fastapi uvicorn[standard] faster-whisper python-multipart
Без пинингования (`==`) может привести к разным версиям пакетов при каждой сборке, что вызывает нестабильность работы.

### 5. Контейнер запускается от root
По умолчанию используется root, что увеличивает риск:
- эксплойтов  
- вредоносного кода
- компрометации хоста  

## ИСПРАВЛЕНИЯ В Dockerfile.good

### 1. Использован лёгкий базовый образ
`python:3.12-bookworm` уменьшает размер образа.

### 2. Корректная установка apt + очистка кэша
rm -rf /var/lib/apt/lists/*

### 3. Копируются только нужные файлы
COPY stt_simple /app/stt_simple
COPY stt_simple/project/requirements.txt /app/requirements.txt

Это уменьшает размер образа и повышает безопасность.

### 4. Установка зависимостей с фиксированными версиями
fastapi==0.115.0
uvicorn[standard]==0.30.3

### 5. Создан отдельный непривилегированный пользователь
RUN useradd -m appuser
USER appuser

## ДВЕ ПЛОХИЕ ПРАКТИКИ ПРИ ИСПОЛЬЗОВАНИИ КОНТЕЙНЕРОВ

### 1. Хранить секреты внутри образа
Нельзя добавлять токены, пароли, ключи прямо в Dockerfile.  
Это приводит к утечкам и нарушению безопасности.

### 2. Использовать контейнеры как постоянное хранилище данных
Контейнеры должны быть stateless.  


## ДВА СЛУЧАЯ, КОГДА НЕ СТОИТ ИСПОЛЬЗОВАТЬ КОНТЕЙНЕРЫ

### монолитные серверные системы, состоящие из множества внутренних демонов
### desktop-приложения или графические оболочки, которым важно окружение полноценной ОС



